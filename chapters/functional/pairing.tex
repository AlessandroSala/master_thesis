\section{Pairing in Hartree--Fock theory}
\label{sec:pairing_hf}
In this section, we will discuss the two common approaches to include nuclear pairing in the HF theory. The aim of these few pages is to provide a brief overview of how the BCS equations are derived and understand the basics of the more general Hartree--Fock--Bogoliubov theory. The former method is the most widely implemented thanks to its low complexity \cite{hfbcsqrpa,oldEv8,skyax}, while the latter, more sophisticated and advanced, is the standard in modern codes \cite{hfodd, hfbftt,MAREVIC2022108367}. We will touch on it so that the reader may appreciate in the numerical chapter the natural extension of this work to the more general Bogoliubov ansatz. The reader may refer to introductory textbooks on many-body theory, such as Ref. \cite{ring2004nuclear} for an in-depth treatment of nuclear pairing.
\subsection{BCS theory}
The BCS approximation, from Bardeen-Cooper-Schrieffer, is the same theory used to describe Cooper pairs in superconductors, applied to the nuclear case.
The ansatz of BCS is that nucleons are paired in states whose total angular momentum is zero, so that the wavefunction of a pair is $\ket{JM}=\ket{00}$ and reads
\begin{equation}
    \label{eq:zero_mom}
    \ket{00} = \sum_{m_j} \bra{jm_j j-m_j}\ket{00}\ket{jm_j}\ket{j-m_j}.
\end{equation}
Introducing the time-reversal operator $\hat {\mathcal T}:t\mapsto -t$, it acts on $\ket{jm_j}$ as 
\begin{equation}
    \hat {\mathcal T} \ket{jm_j} = \widetilde{\ket{{jm_j}}} = (-1)^{j+m_j}\ket{j-m_j},
\end{equation}
and using this relation, Equation~\eqref{eq:zero_mom} becomes 
\begin{equation}
    \ket{00} =- \frac{1}{\sqrt{2j+1}}\sum_{m_j}\ket{jm_j}\widetilde{\ket{{jm_j}}}.
\end{equation}
The BCS ansatz amounts to replacing the Slater determinant with a more general wavefunction where pairs partially occupy time-reversal states. The BCS wavefunction reads
\begin{equation}
    \label{eq:bcs_det}
    \bcs = \prod_{k>0}(u_k+ v_k a_{\tilde k}^\dagger a_k^\dagger) \ket{-}
\end{equation}
where $k$ is a shorthand notation for $\ket{jm}$, $\tilde k = -k$ denotes the time-reversal state of $k$, and $v_k$ and $u_k$ are variational parameters, we shall see shortly that $v_k^2$ is the probability of finding a particle in state $k$. The product runs over positive $k$ only. The BCS wavefunction is the creation in the vacuum of quasi-particles made of time-reversal paired particles, instead of individual ones. The normalization condition on the BCS wavefunction reads
\begin{equation}
    \label{eq:bcs_norm}
    1=\braket{\text{BCS}} = \prod_{k>0} \bra{-}(u_{k}+v_{k}a_{k}a_{\tilde k})(u_k+v_k a_{\tilde k}^\dagger a_k^\dagger)\ket{-} =\prod_{k>0}(u_k^2+v_k^2)=1
\end{equation}
which implies, for every pair $k$, the normalization condition
\begin{equation}
    \label{eq:norm_uv}
    u_k^2+v_k^2=1.
\end{equation}
Taking the expectation value of the particle number operator $\hat N = \sum_k a_k ^\dagger a_k$ yields \cite{bertulani2007nuclear}
\begin{equation}
    \bbcs \hat N \bcs = 2\sum_ {k>0} v_k^2,
\end{equation}
where $v^2_k$ is the probability of finding a particle in state $k$, while the expectation value of the particle number dispersion reads
\begin{equation}
\expval{\Delta\hat N ^2} = \expval{\hat N^2} - \expval{\hat N}^2 = 4\sum_{k>0} v_k^2 u_k^2.
\end{equation}
The consequence of this result is profound. The BCS ansatz does not assume a fixed number of particles, rather it has an expectation value that depends on how the parameters $v_k^2$ are set, and presents fluctations around it.

We can now write the many body Hamiltonian of the system as in Equation~\eqref{eq:mb_hamiltonian_sq}
\begin{equation}
    \hat H = \sum_{k_1 k_2}t_{k_1k_2} a_{k_1}^\dagger a_{k_2} + \frac 1 4 \sum_{k_1 k_2 k_3 k_4}\overline{v}_{k_1k_2k_3k_4} a_{k_1}^\dagger a_{k_2}^\dagger a_{k_3} a_{k_4}
\end{equation}
and replace it with the Routhian 
\begin{equation}
    \label{eq:bcs_routhian}
    \bbcs \hat H - \lambda \hat N \bcs
\end{equation}
so that the expected number of particles may be fixed, under the appropriate choice of $\lambda$, by the relation
\begin{equation}
\pdv{}{N}\bbcs \hat H  \bcs = \lambda.
\end{equation}
the Lagrange multiplier $\lambda$ takes on the meaning of the chemical potential.
We can now apply the variational principle \eqref{eq:var_eq_res} to \eqref{eq:bcs_routhian} using the $v_k$ as variational quantities, which yields 
\begin{equation}
   4\tilde \varepsilon_k ^2 u_k^2 v_k^2 = \Delta_k ^2 - 4\Delta_k^2 u_k^2v_k^2,
\end{equation}
where the pairing gap $\Delta_k$ is defined as
\begin{equation}
    \label{eq:delta_k}
    \Delta_k = - \sum_{k'}\overline v_{k\tilde k k'\tilde{k'}}v_{k'}u_{k'} 
    \end{equation}
and the quantity $\tilde\varepsilon_k$ is defined as 
\begin{align}
    \label{eq:epsilon}
    \tilde \varepsilon_k &= \frac 1 2 \bigg[t_{kk} + t_{\tilde k \tilde k }-2\lambda +\sum_{k'}(\overline v_{k\tilde k k'\tilde{k'}}v_{k'}u_{k'} + \overline v_{\tilde k k' \tilde k k'})v_{k'}^2\bigg]
    \\&=\frac 1 2 [h_{kk}+h_{\tilde k \tilde k}]-\lambda.
\end{align}
Introducing the quasi-particle energy
\begin{equation}
    \label{eq:qpe}
    E_k = \sqrt{\tilde \varepsilon_k^2 +\Delta_k^2}
\end{equation}
we can combine definitions \eqref{eq:delta_k} and \eqref{eq:qpe} with Equation~\eqref{eq:epsilon}, under the normalization condition \eqref{eq:norm_uv}, to get an equation for $v_k^2$
\begin{equation}
    \label{eq:v2}
    v_k^2 = \frac 1 2 \pm \frac{|\tilde \varepsilon_k|}{2E_k}.
\end{equation}
Since in the Hartree--Fock limit, where the occupations $v_k^2$ are equal to one below the Fermi energy and zero above, and the gaps $\Delta_k$ vanish, rendering $E_k=\tilde \varepsilon_k$, we only select the solution
\begin{equation}
v_k^2 = \frac 1 2 - \frac{\tilde \varepsilon_k}{2E_k}.
\end{equation}
Using the normalization condition to write $u_k^2=1-v_k^2$, and plugging it into the gaps definition \eqref{eq:delta_k}, we arrive to the gap equation
\begin{equation}
    \label{eq:gap}
    \Delta_k = - \sum_{k'}\frac{\Delta_{k'}\overline v_{k\tilde k k'\tilde{k'}}}{2E_{k'}}.
\end{equation}
The system of equations (\ref{eq:gap}, \ref{eq:norm_uv}, \ref{eq:v2}, \ref{eq:qpe}, \ref{eq:epsilon}), together with the condition on $\hat N$ -- ie $\expval{\hat N}=N$ -- is closed and can be solved numerically, usually through an effective pairing interaction.
\subsection{Hartree--Fock--Bogoliubov theory}
\label{sec:hfb}
The most general ansatz to account for pairing interactions in Hartree--Fock theory is the Hartree--Fock--Bogoliubov (HFB) theory, that allows a treatment of the mean-field and pairing interactions in a unified way. The quasi-particles created on the vacuum are not necessarily time-reversal pairs but the most general ones according to the symmetries of the system.
Let us start by writing a Bogoliubov transformation from the particle basis $c_i$ to a quasi-particle one 
\begin{equation}
    \label{eq:bogoliubov_trans}
    \beta_k^\dagger = \sum_l U_{lk} c_l^\dagger + V_{lk} c_l.
\end{equation}
If we take the Hermitian conjugate of the relation \eqref{eq:bogoliubov_trans}, we get the transformation for $\beta_k$, and we are then able to write the two in matrix form
\begin{equation}
    \label{eq:bogoliubov_trans_mat}
    \begin{pmatrix}
    \beta\\
    \beta^\dagger
    \end{pmatrix}
    =\begin{pmatrix}
        U^\dagger & V^\dagger \\
        V^T & U^T
    \end{pmatrix}
    \begin{pmatrix}
        c\\
        c^\dagger
    \end{pmatrix}
    =\mathcal W^\dagger \begin{pmatrix}
        c\\
        c^\dagger
    \end{pmatrix},
\end{equation}
where the super-matrix of matrices $\mathcal W$ reads
\begin{equation}
    \label{eq:bogoliubov_mat}
    \mathcal W = \begin{pmatrix}
        U & V^*\\
        V & U^*
    \end{pmatrix}.
\end{equation}
Taking the product $\mathcal W^\dagger \mathcal W$ and imposing separate fermionic commutation relations of the operators $\beta, \beta^\dagger, c, c^\dagger$, we get that $\mathcal W$ is unitary, hence
\begin{equation}
    \mathcal W^\dagger \mathcal W = \mathcal W \mathcal W^\dagger =  I.
\end{equation}
We can now invert Equation~\eqref{eq:bogoliubov_trans_mat} by multiplying both sides on the left by $\mathcal W$, which yields 
\begin{equation*}
    \mathcal W \begin{pmatrix}
        \beta\\
        \beta^\dagger
    \end{pmatrix}
    =\begin{pmatrix}
        c\\
        c^\dagger
    \end{pmatrix}.
\end{equation*}
Using the Messiah-Bloch decomposition \cite{blochmessiah}, we can write the unitary matrix $\mathcal W$ as
\begin{equation}
    \label{eq:decomposition}
    \mathcal W = \begin{pmatrix}
        D & 0 \\
        0 & D^*
    \end{pmatrix}
    \begin{pmatrix}
        \overline U & \overline V \\
        \overline V & \overline U
    \end{pmatrix}
    \begin{pmatrix}
        C & 0 \\
        0 & C^*
    \end{pmatrix}
\end{equation}
where $D$ and $C$ are unitary matrices and $\overline U$ and $\overline V$ are real matrices, which have a particular blocked form, expressed through the coefficents $u_k, v_k$; the reader may refer to appendix \ref{app:uv} for the explicit representation. We can also define the matrices $U, V$ as 
\begin{equation}
    U=D\overline U C,\quad V=D^*\overline V C.
\end{equation}
Using the decomposition \eqref{eq:decomposition} we can define the \textit{canonical basis} as
\begin{equation}
    \label{eq:canonical_basis}
    a_k^\dagger = \sum_l D_{lk}^\dagger c_l^\dagger,
\end{equation}
a \textit{special Bogoliubov transformation} between \textit{paired} levels as
\begin{align}
    \alpha_k^\dagger = u_k a_k^\dagger - v_k a_{\tilde k},\\
    \alpha_{\tilde k } ^\dagger = u_k a_{\tilde k} ^\dagger + v_k a_k,
\end{align}
and \textit{blocked} levels
\begin{align}
\alpha_i &= a_i,\quad \alpha_n^\dagger = a_n^\dagger
\\\alpha_i &= a_i^\dagger, \quad \alpha_n = a_n,
\end{align}
where $u_k=u_{\tilde k},\ v_k=-v_{\tilde k}$, and a unitary transformation of the quasi-particle operators $\alpha_k^\dagger$ among themselves
\begin{equation}
    \beta_k^ \dagger = \sum_{k'}C_{k'k}a_{k'}^\dagger.
\end{equation}
We are now able to define the Bogoliubov ground state $\ket{\text{HFB}}$, as the one for which
\begin{equation}
    \beta_k \ket{\text{HFB}} = 0 \ \forall k = 1,\ldots,M
\end{equation}
where $M$ is the number of single-particle states in the chosen basis.
The wavefunction that satisfies this condition reads
\begin{equation}
\ket{\text{HFB}}=\prod_k^M\beta_k \ket{-}.
\end{equation}
The \textit{pairing tensor} is defined as
\begin{equation}
    \kappa_{ll'} = \bra{\text{HFB}}c_{l'}c_l\ket{\text{HFB}},
\end{equation}
which in matrix form reads
\begin{equation}
    \kappa = UV^\dagger,
\end{equation}
while the density matrix, defined in Equation~\eqref{eq:density_op}, in matrix form reads
\begin{equation}
    \quad \rho = V^*V^T.
\end{equation}
We can now apply the variational principle \eqref{eq:var_eq_res}
\begin{equation}
    \label{eq:varhfb}
    \delta \frac{\bra{\text{HFB}} \hat H-\lambda \hat N\ket{\text{HFB}}}{\bra{\text{HFB}}\ket{\text{HFB}}} = 0,
\end{equation}
which yields the eigenvalue problem
\begin{equation}
    \label{eq:eighfb}
    \begin{pmatrix}
    h -\lambda& \Delta \\ -\Delta^* & -(h-\lambda)^*
    \end{pmatrix}
    \begin{pmatrix}
        U_k \\ V_k
    \end{pmatrix}
    =\mathcal H_\text{HFB}\begin{pmatrix}U_k \\V_k\end{pmatrix}= E_k \begin{pmatrix}
        U_k \\ V_k
    \end{pmatrix},
\end{equation}
here, $h$ is the single-particle Hamiltanian, which reads
\begin{equation}
    h_{kk'} = t_{kk'} +\Gamma_{kk'},
\end{equation}
and $\Gamma_{kk'}$ is the mean-field potential, given by
\begin{equation}
    \label{eq:mean_field_hfb}
    \Gamma_{kk'} = \sum_{ll'}\overline{v}_{kl'k'l}\rho_{ll'},
    \end{equation}
while the pairing field $\Delta$ reads
\begin{equation}
    \label{eq:pairing_field_hfb}
    \Delta_{kk'} = \sum_{ll'}\overline{v}_{kk'll'}\kappa_{ll'}.
\end{equation}
In the canonical basis, we are able to solve for the occupation numbers
\begin{equation}
    \label{eq:occ_hfb}
    u_k^2 = \frac 1 2 \Bigg(1+\frac{h_{kk}+h_{\tilde k \tilde k}}{\sqrt{(h_{kk}+h_{\tilde k \tilde k})^2+4\Delta_{k\tilde k}^2}}\Bigg)
\end{equation}
where $v_k^2 = 1 - u_k^2$ is guaranteed by the unitarity of the matrices.
Starting from an initial guess, we solve the eigenvalue problem \eqref{eq:eighfb}, we extract the occupation numbers \eqref{eq:occ_hfb}, use them to build the new mean-field \eqref{eq:mean_field_hfb} and pairing field \eqref{eq:pairing_field_hfb}, and repeat the process until convergence.
\paragraph{HFB quasi-particle spectrum} Let us assume that $\Psi = (U,\  V )^T$ is a solution of Equation~\eqref{eq:eighfb} with eigenvalue $E$
\begin{equation}
    \label{eq:eigsolhfb}
    \mathcal H_\text{HFB}\Psi = E\Psi.
\end{equation}
Let the particle-hole matrix $\mathcal C$ be defined as
\begin{align}
    \mathcal C = \begin{pmatrix}
        0 & I \\ I&0
    \end{pmatrix},
\end{align}
it is trivial to show that 
\begin{equation}
    \label{eq:hfb_anticomm}
    \mathcal C \mathcal H_\text{HFB} \mathcal C = -\mathcal H_\text{HFB}^*,
\end{equation}
and 
\begin{equation}
    \label{eq:commutationhfb}
    \mathcal C = \mathcal C ^{-1}\implies \mathcal C\mathcal H_\text{HFB} = -\mathcal H_\text{HFB}^*\mathcal C.
\end{equation}
If we take the complex conjugate of Equation~\eqref{eq:eigsolhfb}, we get
\begin{equation}
    \label{eq:eigsolhfb_conj}
    \mathcal H_\text{HFB}^*\Psi ^* = E\Psi^*,
\end{equation}
if we multiply both sides on the left by $\mathcal C$ and use \eqref{eq:commutationhfb}, we get
\begin{align}
    \mathcal H_\text{HFB}\mathcal C\Psi ^* &= -E\mathcal C\Psi^*,
\end{align}
meaning that $\mathcal C \Psi^*$ is a solution of the eigenvalue problem \eqref{eq:eighfb} as well, with eigenvalue $-E$, hence for every quasi-particle state we have a corresponding opposite-sign one; moreover, it can be proven that the HFB hamiltonian is unbounded, both from below and above \cite{Pei2012_HFBcontinuum}. This feature poses a challenge for the numerical diagonalisation of the HFB problem, as we shall see in Section~\ref{sec:eigenvalue_problem}.



